# secrets.yaml
# Defines three Opaque Secrets:
#
#   1. postgres-secret
#      Holds PostgreSQL credentials (POSTGRES_PASSWORD).
#      Always created from values so deployments can reference it (in-cluster
#      postgres-deployment or MemMachine when using external DB). When postgres.enabled
#      is true, the postgres Deployment uses this secret for env vars.
#
#   2. memmachine-secrets
#      Holds OPENAI_API_KEY, injected into the MemMachine container as an env var.
#      Set memmachine.openaiApiKey to your actual key when using OpenAI as the
#      LLM/embedder backend. Use "dummy-key" (default) for Ollama or vLLM backends.
#
#   3. neo4j-secret
#      Holds Neo4j credentials (NEO4J_USER, NEO4J_PASSWORD, NEO4J_AUTH).
#      Consumed by MemMachine (user/password) and by the in-cluster neo4j
#      Deployment (NEO4J_AUTH) when neo4j.enabled is true.
#
# NOTE: For production use, consider providing these secrets out-of-band
#       (e.g., via Vault or sealed-secrets) rather than setting them in values.yaml.
apiVersion: v1
kind: Secret
metadata:
  name: postgres-secret
  namespace: {{ .Release.Namespace }}
type: Opaque
stringData:
  POSTGRES_PASSWORD: {{ .Values.postgres.password }}
---
apiVersion: v1
kind: Secret
metadata:
  name: memmachine-secrets
  namespace: {{ .Release.Namespace }}
type: Opaque
stringData:
  OPENAI_API_KEY: {{ .Values.memmachine.openaiApiKey }}
---
apiVersion: v1
kind: Secret
metadata:
  name: neo4j-secret
  namespace: {{ .Release.Namespace }}
type: Opaque
stringData:
  NEO4J_USER: {{ .Values.neo4j.user }}
  NEO4J_PASSWORD: {{ .Values.neo4j.password }}
  NEO4J_AUTH: {{ .Values.neo4j.user }}/{{ .Values.neo4j.password }}
