{
  "openapi": "3.1.0",
  "info": {
    "title": "MemMachine API",
    "version": "2.1.0",
    "description": "Architectural Memory Systems for AI Agents. Specialized in episodic and semantic memory management with strict namespace isolation."
  },
  "servers": [
    {
      "url": "http://localhost:8080"
    }
  ],
  "tags": [
    {
      "name": "Projects",
      "description": "Lifecycle management for isolated memory namespaces."
    },
    {
      "name": "Memories",
      "description": "Core operations for episodic and semantic memory ingestion and retrieval."
    },
    {
      "name": "Configuration",
      "description": "Runtime resource management and system configuration."
    },
    {
      "name": "System",
      "description": "Infrastructure, health, and observability."
    }
  ],
  "paths": {
    "/api/v2/projects": {
      "post": {
        "tags": ["Projects"],
        "summary": "Create Project",
        "description": "Create a new project under a specified organization. Each project acts as an isolated memory namespace.",
        "operationId": "create_project",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/CreateProjectSpec" },
              "example": {
                "org_id": "acme-corp",
                "project_id": "agent-smith-v1",
                "description": "Primary memory store for customer support agent",
                "config": {
                  "embedder": "openai-text-3-small",
                  "reranker": "cohere-rerank-english-v3.0"
                }
              }
            }
          },
          "required": true
        },
        "responses": {
          "201": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProjectResponse" } } } },
          "422": { "description": "Validation Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/HTTPValidationError" } } } }
        }
      }
    },
    "/api/v2/projects/get": {
      "post": {
        "tags": ["Projects"],
        "summary": "Get Project",
        "operationId": "get_project",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GetProjectSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ProjectResponse" } } } }
        }
      }
    },
    "/api/v2/projects/episode_count/get": {
      "post": {
        "tags": ["Projects"],
        "summary": "Get Episode Count",
        "operationId": "get_episode_count",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GetProjectSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/EpisodeCountResponse" } } } }
        }
      }
    },
    "/api/v2/projects/list": {
      "post": {
        "tags": ["Projects"],
        "summary": "List Projects",
        "operationId": "list_projects",
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "type": "array", "items": { "type": "object", "additionalProperties": { "type": "string" } } } } } }
        }
      }
    },
    "/api/v2/projects/delete": {
      "post": {
        "tags": ["Projects"],
        "summary": "Delete Project",
        "operationId": "delete_project",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteProjectSpec" } } },
          "required": true
        },
        "responses": {
          "204": { "description": "Successful Response" }
        }
      }
    },
    "/api/v2/memories": {
      "post": {
        "tags": ["Memories"],
        "summary": "Add Memories",
        "operationId": "add_memories",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/AddMemoriesSpec" }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddMemoriesResponse" } } } }
        }
      }
    },
    "/api/v2/memories/search": {
      "post": {
        "tags": ["Memories"],
        "summary": "Search Memories",
        "operationId": "search_memories",
        "requestBody": {
          "content": {
            "application/json": {
              "schema": { "$ref": "#/components/schemas/SearchMemoriesSpec" }
            }
          },
          "required": true
        },
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/SearchResult" } } } }
        }
      }
    },
    "/api/v2/memories/list": {
      "post": {
        "tags": ["Memories"],
        "summary": "List Memories",
        "operationId": "list_memories",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ListMemoriesSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ListResult" } } } }
        }
      }
    },
    "/api/v2/config": {
      "get": {
        "tags": ["Configuration"],
        "summary": "Get Config",
        "operationId": "get_config",
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/GetConfigResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources": {
      "get": {
        "tags": ["Configuration"],
        "summary": "Get Resources Status",
        "operationId": "get_resources",
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/ResourcesStatus" } } } }
        }
      }
    },
    "/api/v2/config/memory": {
      "put": {
        "tags": ["Configuration"],
        "summary": "Update Memory Config",
        "operationId": "update_memory_config",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigSpec" } } },
          "required": true
        },
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateMemoryConfigResponse" } } } },
          "400": { "description": "Bad Request", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestErrorModel" } } } }
        }
      }
    },
    "/api/v2/config/resources/embedders": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Add Embedder",
        "operationId": "add_embedder",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddEmbedderSpec" } } },
          "required": true
        },
        "responses": {
          "201": { "description": "Created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } },
          "422": { "description": "Validation Error", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RestErrorModel" } } } }
        }
      }
    },
    "/api/v2/config/resources/language_models": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Add Language Model",
        "operationId": "add_language_model",
        "requestBody": {
          "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AddLanguageModelSpec" } } },
          "required": true
        },
        "responses": {
          "201": { "description": "Created", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources/embedders/{name}": {
      "delete": {
        "tags": ["Configuration"],
        "summary": "Delete Embedder",
        "operationId": "delete_embedder",
        "parameters": [{ "name": "name", "in": "path", "required": true, "schema": { "type": "string" } }],
        "responses": {
          "200": { "description": "Deleted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteResourceResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources/language_models/{name}": {
      "delete": {
        "tags": ["Configuration"],
        "summary": "Delete Language Model",
        "operationId": "delete_language_model",
        "parameters": [{ "name": "name", "in": "path", "required": true, "schema": { "type": "string" } }],
        "responses": {
          "200": { "description": "Deleted", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/DeleteResourceResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources/embedders/{name}/retry": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Retry Embedder",
        "operationId": "retry_embedder",
        "parameters": [{ "name": "name", "in": "path", "required": true, "schema": { "type": "string" } }],
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources/language_models/{name}/retry": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Retry Language Model",
        "operationId": "retry_language_model",
        "parameters": [{ "name": "name", "in": "path", "required": true, "schema": { "type": "string" } }],
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/api/v2/config/resources/rerankers/{name}/retry": {
      "post": {
        "tags": ["Configuration"],
        "summary": "Retry Reranker",
        "operationId": "retry_reranker",
        "parameters": [{ "name": "name", "in": "path", "required": true, "schema": { "type": "string" } }],
        "responses": {
          "200": { "description": "Successful Response", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UpdateResourceResponse" } } } }
        }
      }
    },
    "/api/v2/health": {
      "get": {
        "tags": ["System"],
        "summary": "Health Check",
        "operationId": "health_check",
        "responses": { "200": { "description": "Successful Response" } }
      }
    },
    "/api/v2/metrics": {
      "get": {
        "tags": ["System"],
        "summary": "Metrics",
        "description": "Expose Prometheus metrics endpoint for system observability.",
        "operationId": "metrics",
        "responses": {
          "200": {
            "description": "Prometheus metrics (text/plain in production).",
            "content": {
              "application/json": {
                "schema": {
                  "type": "object",
                  "additionalProperties": {
                    "type": "number"
                  }
                },
                "example": {
                  "memmachine_episodes_total": 42,
                  "memmachine_semantic_entries": 128
                }
              },
              "text/plain": {
                "schema": {
                  "type": "string"
                }
              }
            }
          }
        }
      }
    }
  },
  "components": {
    "schemas": {
      "CreateProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "description": { "type": "string" },
          "config": { "$ref": "#/components/schemas/ProjectConfig" }
        }
      },
      "ProjectConfig": {
        "type": "object",
        "properties": {
          "embedder": { "type": "string" },
          "reranker": { "type": "string" }
        }
      },
      "ProjectResponse": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "description": { "type": "string" },
          "config": { "$ref": "#/components/schemas/ProjectConfig" }
        }
      },
      "GetProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" }
        }
      },
      "DeleteProjectSpec": {
        "type": "object",
        "required": ["org_id", "project_id"],
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" }
        }
      },
      "AddMemoriesSpec": {
        "type": "object",
        "required": ["messages"],
        "properties": {
          "org_id": { "type": "string", "default": "universal" },
          "project_id": { "type": "string", "default": "universal" },
          "messages": { "type": "array", "items": { "$ref": "#/components/schemas/MemoryMessage" } }
        }
      },
      "MemoryMessage": {
        "type": "object",
        "required": ["content"],
        "properties": {
          "content": { "type": "string" },
          "role": { "type": "string", "default": "user" },
          "timestamp": { "type": "string" },
          "metadata": { "type": "object" }
        }
      },
      "AddMemoriesResponse": {
        "type": "object",
        "properties": { "results": { "type": "array", "items": { "type": "object" } } }
      },
      "SearchMemoriesSpec": {
        "type": "object",
        "required": ["query"],
        "properties": {
          "org_id": { "type": "string", "default": "universal" },
          "project_id": { "type": "string", "default": "universal" },
          "query": { "type": "string" },
          "top_k": { "type": "integer", "default": 10 },
          "types": { "type": "array", "items": { "type": "string" } }
        }
      },
      "SearchResult": {
        "type": "object",
        "required": ["status", "content"],
        "properties": {
          "status": { "type": "integer" },
          "content": { "type": "object", "additionalProperties": true }
        }
      },
      "ListMemoriesSpec": {
        "type": "object",
        "properties": {
          "org_id": { "type": "string" },
          "project_id": { "type": "string" },
          "page_size": { "type": "integer", "default": 20 },
          "page_num": { "type": "integer", "default": 0 }
        }
      },
      "ListResult": {
        "type": "object",
        "required": ["items", "total"],
        "properties": {
          "items": { "type": "array", "items": { "type": "object" } },
          "total": { "type": "integer" }
        }
      },
      "EpisodeCountResponse": {
        "type": "object",
        "required": ["count"],
        "properties": { "count": { "type": "integer" } }
      },
      "GetConfigResponse": {
        "type": "object",
        "required": ["resources"],
        "properties": { "resources": { "$ref": "#/components/schemas/ResourcesStatus" } }
      },
      "ResourcesStatus": {
        "type": "object",
        "required": ["embedders", "language_models", "rerankers"],
        "minProperties": 1,
        "properties": {
          "embedders": { "type": "array", "items": { "$ref": "#/components/schemas/ResourceInfo" } },
          "language_models": { "type": "array", "items": { "$ref": "#/components/schemas/ResourceInfo" } },
          "rerankers": { "type": "array", "items": { "$ref": "#/components/schemas/ResourceInfo" } },
          "databases": { "type": "array", "items": { "$ref": "#/components/schemas/ResourceInfo" } }
        }
      },
      "ResourceInfo": {
        "type": "object",
        "required": ["name", "provider", "status"],
        "properties": {
          "name": { "type": "string" },
          "provider": { "type": "string" },
          "status": { "type": "string", "enum": ["READY", "FAILED", "INITIALIZING"] },
          "error": { "type": "string", "nullable": true }
        }
      },
      "UpdateMemoryConfigSpec": {
        "type": "object",
        "description": "Requires at least one of the two top-level fields.",
        "minProperties": 1,
        "properties": {
          "episodic_memory": {
            "type": "object",
            "anyOf": [
              { "required": ["episodic_memory"] },
              { "required": ["semantic_memory"] }
            ],
            "properties": {
              "enabled": { "type": "boolean" },
              "long_term_memory_enabled": { "type": "boolean" },
              "short_term_memory_enabled": { "type": "boolean" },
              "long_term_memory": {
                "type": "object",
                "properties": {
                  "embedder": { "type": "string" },
                  "reranker": { "type": "string" },
                  "vector_graph_store": { "type": "string" }
                }
              },
              "short_term_memory": {
                "type": "object",
                "properties": {
                  "llm_model": { "type": "string" },
                  "message_capacity": { "type": "integer" }
                }
              }
            }
          },
          "semantic_memory": {
            "type": "object",
            "properties": {
              "enabled": { "type": "boolean" },
              "database": { "type": "string" },
              "llm_model": { "type": "string" },
              "embedding_model": { "type": "string" },
              "ingestion_trigger_messages": { "type": "integer" },
              "ingestion_trigger_age_seconds": { "type": "integer" }
            }
          }
        }
      },
      "UpdateMemoryConfigResponse": {
        "type": "object",
        "required": ["success", "message"],
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        }
      },
      "AddEmbedderSpec": {
        "type": "object",
        "required": ["name", "provider", "config"],
        "properties": {
          "name": { "type": "string" },
          "provider": { "type": "string", "enum": ["openai", "amazon-bedrock", "sentence-transformer"] },
          "config": {
            "type": "object",
            "description": "Required fields depend on provider (e.g., api_key for openai).",
            "properties": {
              "model": { "type": "string" },
              "api_key": { "type": "string", "format": "password" },
              "aws_region": { "type": "string" },
              "aws_access_key_id": { "type": "string" },
              "aws_secret_access_key": { "type": "string" }
            },
            "additionalProperties": true
          }
        }
      },
      "AddLanguageModelSpec": {
        "type": "object",
        "required": ["name", "provider", "config"],
        "properties": {
          "name": { "type": "string" },
          "provider": { "type": "string", "enum": ["openai-responses", "openai-chat-completions", "amazon-bedrock"] },
          "config": { "type": "object", "additionalProperties": true }
        }
      },
      "UpdateResourceResponse": {
        "type": "object",
        "required": ["success", "status"],
        "properties": {
          "success": { "type": "boolean" },
          "status": { "type": "string", "enum": ["READY", "FAILED", "INITIALIZING"] },
          "error": { "type": "string", "nullable": true }
        }
      },
      "DeleteResourceResponse": {
        "type": "object",
        "required": ["success", "message"],
        "properties": {
          "success": { "type": "boolean" },
          "message": { "type": "string" }
        }
      },
      "RestErrorModel": {
        "type": "object",
        "required": ["code", "message"],
        "properties": {
          "code": { "type": "integer" },
          "message": { "type": "string" },
          "exception": { "type": "string" },
          "internal_error": { "type": "string" },
          "trace": { "type": "string" }
        }
      },
      "HTTPValidationError": {
        "type": "object",
        "required": ["detail"],
        "properties": {
          "detail": { "type": "array", "items": { "type": "object" } }
        }
      }
    }
  }
}